# Refinement Tracking: FRD-01 Configuration Schema & Loading System

## Analysis Progress
- [x] Initial codebase scan
- [x] Backend support analysis (domain layer, application layer)
- [x] CLI patterns analysis
- [x] Configuration merging strategy
- [x] Template system design
- [x] Validation system design
- [x] Infrastructure integration
- [x] Testing requirements

## Status: COMPLETE

All concerns analyzed. FRD marked as "Codebase Aligned and Ready for Task Breakdown".

## Findings Summary

### Backend Support Analysis
- **MaterialType enum** exists and matches FRD exactly
- **MaterialSpec** value object available for reuse
- **Clean architecture** already established (domain/application/infrastructure)
- **Validation pattern** using `validate()` methods that return error lists
- **Gap identified**: No Pydantic, no "fill" width support, no section-level configuration

### CLI Patterns Analysis
- **Typer** framework in use with `@app.command()` pattern
- **Annotated parameters** with `typer.Option()` for help text
- **Error handling** via `typer.Exit(code=1)`
- **Multiple commands** exist: generate, cutlist, materials, diagram

### Configuration Merging Strategy
- No existing merging logic - CLI directly populates DTOs
- Recommended: CLI args > config values > defaults
- v1 scope: top-level overrides only

### Template System Design
- No existing template system
- Recommended: `importlib.resources` for package data
- pyproject.toml update needed for package-data configuration

### Validation System Design
- Existing `validate()` methods return error lists
- Pydantic v2 provides `loc` for JSON path construction
- Warning system is NEW (not existing)

### Infrastructure Integration
- Add `pydantic>=2.0` dependency
- Create `config/`, `templates/`, `cli/commands/` packages
- No tests directory exists - needs creation

## Lateral Moves Identified

### LM-01: Add Pydantic Dependency
- **Status**: Required
- **Impact**: Low - additive change

### LM-02: DTO Coexistence Strategy
- **Status**: Decision made - preserve existing DTOs with conversion layer
- **Impact**: Medium - requires adapter code
- **Rationale**: Non-breaking, allows gradual migration

### LM-03: Section Width Enhancement
- **Status**: Required for full FRD implementation
- **Impact**: Medium - domain layer changes to LayoutCalculator
- **Details**: Add algorithm to resolve mixed fixed/"fill" widths

## Key Integration Points

| File | Action | Notes |
|------|--------|-------|
| `pyproject.toml` | Modify | Add pydantic, package-data |
| `domain/value_objects.py` | Reuse | MaterialType enum |
| `domain/services.py` | Extend | LayoutCalculator for section widths |
| `application/dtos.py` | Preserve | WallInput, LayoutParametersInput |
| `cli/main.py` | Modify | Add --config flag |

## Implementation Estimate

- **Total effort**: 14-19 days
- **Risk level**: Low-Medium
- **Blocking decisions**: LM-02 (DTO strategy) - recommendation provided

---

*Completed: 2025-12-27*
*Analyst: FRD Refinement Specialist*
